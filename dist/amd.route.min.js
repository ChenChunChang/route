(function(){define(function(t,e,n){var i=/^.+?\/+[^\/]+/,r="EventListener",f="remove"+r,o="add"+r,s="hasAttribute",u="replace",a="popstate",c="trigger",h=window,l=document,p=h.history.location||h.location,d=K.prototype,v=l&&l.ontouchstart?"touchstart":"click",m=false,b=observable(),g,w,y,$;function x(t){return t.split(/[/?#]/)}function A(t,e){var n=new RegExp("^"+e[u](/\*/g,"(\\w+)")[u](/\.\./,".*")+"$");if(args=t.match(n))return args.slice(1)}function K(){this.$=[];observable(this);b.on("stop",this.s.bind(this));b.on("emit",this.e.bind(this))}function N(t){return t[u](/^\/|\/$/,"")}function E(t){return(t||p.href)[u](i,"")}function k(t){return g[0]=="#"?(t||p.href).split(g)[1]||"":E(t)[u](g,"")}function q(t){var e=k();if(t||e!=w){b[c]("emit",e);w=e}}function D(t){if(t.which!=1||t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)return;var e=t.target;while(e&&e.nodeName!="A")e=e.parentNode;if(!e||e.nodeName!="A"||e[s]("download")||!e[s]("href")||e.target&&e.target!="_self"||e.href.indexOf(p.href.match(i)[0])==-1)return;if(e.href!=p.href){if(e.href.split("#")[0]==p.href.split("#")[0])return;L(k(e.href),e.title||l.title)}t.preventDefault()}function L(t,e){e=e||l.title;history.pushState(null,e,g+t);l.title=e;q()}d.m=function(t,e){if(t[0]&&(!e||e[0]))L(t,e);else if(e)this.r(t,e);else this.r("@",t)};d.s=function(){this.off("*");this.$=[]};d.e=function(t){this.$.concat("@").some(function(e){var n=(e=="@"?y:$)(N(t),N(e));if(n){this[c].apply(null,[e].concat(n));return true}},this)};d.r=function(t,e){if(t!="@")this.$.push(t);this.on(t,e)};var O=new K;var P=O.m.bind(O);P.create=function(){var t=new K;t.m.stop=t.s.bind(t);return t.m.bind(t)};P.base=function(t){g=t||"#";w=k()};P.exec=function(){q(true)};P.parser=function(t,e){if(!t&&!e){y=x;$=A}if(t)y=t;if(e)$=e};P.query=function(){var t={};p.href[u](/[?&](.+?)=([^&]*)/g,function(e,n,i){t[n]=i});return t};P.stop=function(){if(m){h[f](a,q);l[f](v,D);b[c]("stop");m=false}};P.start=function(){if(!m){h[o](a,q);l[o](v,D);m=true}};P.base();P.parser();P.start()})})();