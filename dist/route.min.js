(function(){"use strict";var t=function(t){t=t||{};var n={},e=function(t,n){t.replace(/\S+/g,n)};t.on=function(i,r){if(typeof r!="function")return t;e(i,function(t,e){(n[t]=n[t]||[]).push(r);r.typed=e>0});return t};t.off=function(i,r){if(i=="*")n={};else{e(i,function(t){if(r){var e=n[t];for(var i=0,f;f=e&&e[i];++i){if(f==r)e.splice(i--,1)}}else delete n[t]})}return t};t.one=function(n,e){function i(){t.off(n,i);e.apply(t,arguments)}return t.on(n,i)};t.trigger=function(i){var r=[].slice.call(arguments,1);e(i,function(e){var i=n[e]||[];for(var f=0,o;o=i[f];++f){if(o.busy)return;o.busy=1;o.apply(t,o.typed?[e].concat(r):r);if(i[f]!==o)f--;o.busy=0}if(n.all&&e!="all")t.trigger.apply(t,["all",e].concat(r))});return t};return t};var n=/^.+?\/+[^\/]+/,e="EventListener",i="remove"+e,r="add"+e,f="hasAttribute",o="replace",u="popstate",c="trigger",a=window,s=document,l=a.history.location||a.location,h=x.prototype,p=s&&s.ontouchstart?"touchstart":"click",d=false,v=t(),y,m,g,b;function w(t){return t.split(/[\/?#]/)}function $(t,n){var e=new RegExp("^"+n[o](/\*/g,"(\\w+)")[o](/\.\./,".*")+"$"),i=t.match(e);if(i)return i.slice(1)}function x(){this.$=[];t(this);v.on("stop",this.s.bind(this));v.on("emit",this.e.bind(this))}function A(t){return t[o](/^\/|\/$/,"")}function K(t){return(t||l.href)[o](n,"")}function N(t){return y[0]=="#"?(t||l.href).split(y)[1]||"":K(t)[o](y,"")}function E(t){var n=N();if(t||n!=m){v[c]("emit",n);m=n}}function S(t){if(t.which!=1||t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)return;var e=t.target;while(e&&e.nodeName!="A")e=e.parentNode;if(!e||e.nodeName!="A"||e[f]("download")||!e[f]("href")||e.target&&e.target!="_self"||e.href.indexOf(l.href.match(n)[0])==-1)return;if(e.href!=l.href){if(e.href.split("#")[0]==l.href.split("#")[0])return;k(N(e.href),e.title||s.title)}t.preventDefault()}function k(t,n){n=n||s.title;history.pushState(null,n,y+t);s.title=n;E()}h.m=function(t,n){if(t[0]&&(!n||n[0]))k(t,n);else if(n)this.r(t,n);else this.r("@",t)};h.s=function(){this.off("*");this.$=[]};h.e=function(t){this.$.concat("@").some(function(n){var e=(n=="@"?g:b)(A(t),A(n));if(e){this[c].apply(null,[n].concat(e));return true}},this)};h.r=function(t,n){if(t!="@")this.$.push(t);this.on(t,n)};var q=new x;var D=q.m.bind(q);D.create=function(){var t=new x;t.m.stop=t.s.bind(t);return t.m.bind(t)};D.base=function(t){y=t||"#";m=N()};D.exec=function(){E(true)};D.parser=function(t,n){if(!t&&!n){g=w;b=$}if(t)g=t;if(n)b=n};D.query=function(){var t={};l.href[o](/[?&](.+?)=([^&]*)/g,function(n,e,i){t[e]=i});return t};D.stop=function(){if(d){a[i](u,E);s[i](p,S);v[c]("stop");d=false}};D.start=function(){if(!d){a[r](u,E);s[r](p,S);d=true}};D.base();D.parser();D.start();window.route=D})();